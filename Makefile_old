##
##  HYDRA test Makefile
##

GLOBAL_PATH = /home/maciej/pro/hydra/

ECHO	= echo
SHELL	= /bin/sh

CC	= gcc
WFLAGS 	= -ansi -pedantic -Wall \
	-Wshadow \
	-Wmissing-prototypes -Wstrict-prototypes \
	-Wpointer-arith -Wcast-qual -Wcast-align \
	-Wwrite-strings -Wnested-externs \
	-fshort-enums -fno-common -Dinline=

OFLAGS 	= #-O3
GDBFLAGS = -ggdb
MFLAGS = -m96bit-long-double -mpc80
CFLAGS	= $(WFLAGS) $(OFLAGS) $(GDBFLAGS) $(MFLAGS) \
	-std=c99 -c -march=core2 -fopenmp -I/home/maciej/pro/ric.new/wmric \
	-I/home/maciej/pro/yapdes/src/yapdes \
	-DGLOBAL_PATH=$(GLOBAL_PATH)


LDFLAGS	= -lm -lgsl -lgslcblas -lswps -fopenmp -lwmric \
	-I/home/maciej/pro/ric.new/wmric -L/home/maciej/pro/ric.new \
	-L/home/maciej/pro/yapdes -lyapdes


DIRS	= src
SOURCES	= $(foreach dir, $(DIRS), $(wildcard $(dir)/*.c)) 
OBJECTS	= $(patsubst %.c, %.o, $(SOURCES))


all: h_grid_alloc_test


h_grid_alloc_test: ./testing/h_grid_alloc_test.o $(OBJECTS)
	@echo $(GLOBAL_PATH)
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@
	$(CC) $(OBJECTS) ./testing/h_grid_alloc_test.o $(LDFLAGS) -o ./testing/h_grid_alloc_test

.c.o:
	$(CC) $(CFLAGS) $< -o $@


.PHONY: clean cleanbkp cleanobj cleanx $(DIRS) project

clean: cleanbkp cleanobj cleanx

cleanbkp:
	@find . -type f -iname '*~' -exec rm -v {} \;

cleanobj:
	@find . -type f -iname '*.o' -exec rm -v {} \;

cleanx:
	@-rm -fv main_ad1D conv_test \;
